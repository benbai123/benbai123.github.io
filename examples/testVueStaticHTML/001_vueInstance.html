<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
		<meta http-equiv="pragma" content="no-cache" />
		
		<link rel="stylesheet" href="codemirror/lib/codemirror.css">
		<link rel="stylesheet" href="css/base.css" />
		
		<script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
		<script type="text/javascript" src="js/underscore.js"></script>
		
		<script src="codemirror/lib/codemirror.js"></script>
		<script src="codemirror/mode/javascript/javascript.js"></script>
		<script src="codemirror/addon/hint/show-hint.js"></script>
		<script src="codemirror/addon/hint/xml-hint.js"></script>
		<script src="codemirror/addon/hint/html-hint.js"></script>
		<script src="codemirror/mode/xml/xml.js"></script>
		<script src="codemirror/mode/javascript/javascript.js"></script>
		<script src="codemirror/mode/css/css.js"></script>
		<script src="codemirror/mode/htmlmixed/htmlmixed.js"></script>
		<script src="codemirror/mode/htmlembedded/htmlembedded.js"></script>
		<script src="codemirror/addon/display/placeholder.js"></script>
	</head>
    <body>
		<div class="tests">
			<div class="test-block exec">
				<div class="desc">template syntax</div>
				<textarea class="html" placeholder="Enter HTML">
					
				</textarea>
				<textarea class="js" placeholder="Enter Test JavaScript">
					
				</textarea>
				try this Console CMD (input js then press Enter)
				<textarea class="test-console" placeholder="Enter Console CMD"></textarea>
			</div>
			<div class="samples">
				<div class="inst">Click to Select Sample</div>
				
				<div class="test-block src">
					<div class="desc">
						Vue instance sync with data automatically
					</div>
					<textarea class="html" placeholder="Enter HTML">
						<div id="out"></div>
					</textarea>
					<textarea class="js" placeholder="Enter Test JavaScript">
						// Our data object
						var data = { a: 1 },
							out = document.getElementById('out');

						// The object is added to a Vue instance
						var vm = new Vue({
						  data: data
						})

						// Getting the property on the instance
						// returns the one from the original data
						out.innerHTML += (vm.a == data.a)+'<br/>';
						vm.a == data.a // => true

						// Setting the property on the instance
						// also affects the original data
						vm.a = 2
						out.innerHTML += (data.a)+'<br/>';

						// ... and vice-versa
						data.a = 3
						vm.a // => 3
						out.innerHTML += (vm.a)+'<br/>';
						
						// property not exists at the beginning, not works
						vm.b = 5;
						out.innerHTML += (data.b)+'<br/>';
					</textarea>
					<textarea class="test-console" placeholder="Enter Console CMD"></textarea>
				</div>
				
				<div class="test-block src">
					<div class="desc">
						Vue default instance properties
					</div>
					<textarea class="html" placeholder="Enter HTML">
						<div id="example" v-html="message">
						</div>
					</textarea>
					<textarea class="js" placeholder="Enter Test JavaScript">
						var data = { a: 1, message: '' }
						var vm = new Vue({
						  el: '#example',
						  data: data
						})
						
						// instance properties start with '$'
						data.message +=
							vm.$data === data // => true
						data.message += '<br/>';
						data.message +=
							vm.$el === document.getElementById('example') // => true
						data.message += '<br/>';

						// $watch is an instance method
						vm.$watch('a', function (newValue, oldValue) {
						  // This callback will be called when `vm.a` changes
						  data.message += 'vm.a changed from ' + oldValue + ' to ' + newValue;
						  data.message += '<br/>';
						})
					</textarea>
					<textarea class="test-console" placeholder="Enter Console CMD">
						vm.a = 123;
					</textarea>
				</div>
				
				<div class="test-block src">
					<div class="desc">
						Vue lifecycle hooks
					</div>
					<textarea class="html" placeholder="Enter HTML">
						<div id="example" v-html="msg">
						</div>
						Ref: 
						<a href="https://vuejs.org/v2/guide/instance.html#Lifecycle-Diagram" target="_blank">Vue Lifecycle Diagram</a>
						<br />
						<a href="https://vuejs.org/v2/api/#Options-Lifecycle-Hooks" target="_blank">Vue Lifecycle Hooks</a>
					</textarea>
					<textarea class="js" placeholder="Enter Test JavaScript">
						new Vue({
						  el: '#example',
						  data: {
							a: 1, msg: ''
						  },
						  created: function () {
							// `this` points to the vm instance
							this.msg = 'created, a is: ' + this.a;
						  }
						})
					</textarea>
					<textarea class="test-console" placeholder="Enter Console CMD"></textarea>
				</div>
			</div>
		</div>
		<iframe id="iframe" frameBorder="0"></iframe>
		<script>
			function writeIframe (html) {
				if (!html) return;
				var win = document.getElementById('iframe').contentWindow,
					doc = win.document;
				doc.open();
				doc.write(html);
				doc.close();
			}
			function evalJSInIframe (js) {
				if (!js) return;
				var win = document.getElementById('iframe').contentWindow;
				var doc = win.document;
				var s = doc.createElement('script');
				s.src = 'https://cdn.jsdelivr.net/npm/vue/dist/vue.js';
				s.onload = function () {
					win.eval(js);
				}
				doc.head.appendChild(s);
			}
		</script>
		<script>
			var htmlCM,
				jsCM,
				consoleCM;
			function _exec (ta) {
				console.log('_exec');
				$('#iframe').remove();
				$('body').append('<iframe id="iframe" frameBorder="0"></iframe>');
				try {
					var html = htmlCM.getValue(),
						js = jsCM.getValue();
					console.log(html);
					console.log(js);
					writeIframe(html);
					evalJSInIframe(js);
				} catch (e) {console.log(e);}
			}
			window.onload = function () {
				var cmds = [], curr = 0;
				var exec = _.debounce(function (cm) {
						try {
							var ta = cm.getTextArea();
							ta.value = cm.getValue();
							_exec(ta);
						} catch (e) {}
					}, 500),
					cmd = function (cm, evt) {
						try {
							// ArrowUp, ArrowDown, Enter
							var key = evt.key,
								pos = cm.getCursor(),
								ta = cm.getTextArea();
							if ( (pos.outside || !cm.getValue()) && key=='ArrowUp' && curr>0) {
								curr--;
								cm.setValue(cmds[curr]);
								cm.setCursor(0, 1);
							}
							if ( (pos.outside || !cm.getValue()) && key=='ArrowDown' && curr<cmds.length-1) {
								curr++;
								cm.setValue(cmds[curr]);
								cm.setCursor(0, cmds[curr].length-1);
							}
							if (key=='Enter' && !evt.shiftKey) {
								var js = ta.value;
								console.log(js);
								if (js) {
									cmds.push(js);
									curr = cmds.length;
									cm.setValue('');
									document.getElementById('iframe').contentWindow.eval(js);
								}
							}
							ta.value = cm.getValue();
						} catch (e) {}
					};
				$('.test-block.exec textarea.html').each(function () {
					var htmlTextarea = $(this);
					htmlCM = CodeMirror.fromTextArea(htmlTextarea[0], {mode: "htmlmixed"});
					htmlCM.on('keyup', exec);
					htmlCM.on('focus', exec);
					console.log(htmlCM);
				});
				$('.test-block.exec textarea.js').each(function () {
					var jsTextarea = $(this);
					jsCM = CodeMirror.fromTextArea(jsTextarea[0], {mode: "javascript"});
					jsCM.on('keyup', exec);
					jsCM.on('focus', exec);
				});
				$('.test-block.exec textarea.test-console').each(function () {
					var jsTextarea = $(this);
					consoleCM = CodeMirror.fromTextArea(jsTextarea[0], {mode: "javascript"});
					consoleCM.on('keyup', cmd);
				});
				
				$('.samples .inst').on('click', function () {
					$('.samples').toggleClass('open');
				});
				
				function applyValue (cm, val) {
					val = val || '';
					val = val.replace(/\t\t\t\t\t/g, ' ');
					cm.setValue(val);
					cm.getTextArea().value = val;
				}
				
				function _applyTest ($desc) {
					$('.samples').removeClass('open');
					var $block = $desc.closest('.test-block');
					applyValue(htmlCM, $block.find('textarea.html').val());
					applyValue(jsCM, $block.find('textarea.js').val());
					applyValue(consoleCM, $block.find('textarea.test-console').val());
					$('.test-block.exec .desc').html($desc.html());
					_exec(htmlCM.getTextArea());
				}
				function applyTest (e) {
					_applyTest($(e.target));
				}
				$('.test-block.src .desc').on('click', applyTest);
				_applyTest($('.test-block.src .desc').eq(0));
            }
		</script>
	</body>
</html>